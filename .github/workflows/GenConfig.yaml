name: GenConfig

on:
  push:
    branches:
      - main
  workflow_dispatch: #æ‰‹åŠ¨è°ƒè¯•æŒ‰é’®

jobs:
  GenConfig:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3 #Git Clone
    - uses: actions/setup-node@v3 #Node.jsç¯å¢ƒ
      with:
        node-version: '16.x' #Node.js 16.x
    - name: ğŸ”§ Timezone #UTC+0 â†’ UTC+8
      run: sudo timedatectl set-timezone 'Asia/Shanghai'
    - name: ğŸ”§ Git #é…ç½®Gitçš„ä¸Šä¼ ç”¨æˆ·åå’Œé‚®ç®±
      run: |
        git config pull.rebase false
        git config --local user.name "GitHub Actions"
        git config --local user.email "actions@github.com"
    - name: ğŸ“¦ï¸ YARN #å®‰è£…yarnåŒ…
      run: |
        cd ./Script/
        yarn install
    - name: ğŸ§ª Run Script
      run: |
        cd ./Script/
        yarn start
    - name: Change
      run: |
        git fetch
        git checkout config
    - name: ğŸ—‘ï¸ Delete #åˆ é™¤æ–‡ä»¶
      run: |
        rm -rf ./.github/
        rm -rf ./DB/
        rm -rf ./Script/
        rm -f ./.gitignore
        rm -f ./LICENSE
        rm -f ./README.md
    - name: ğŸ”€ Remove #ç§»åŠ¨æ–‡ä»¶
      run: |
       cp -rf ./Config/* ./
       rm -rf ./Config/
    - name: ğŸ”€ Git #Git
      run: |
        status_log=$(git status -sb)
        echo "$status_log"
        if [ "$status_log" == "## config...origin/config" ];then
          echo -e "\033[42;30m nothing to commit, working tree clean \033[0m"
        else
          git status -s
          git add .
          git commit -m "è‡ªåŠ¨æ›´æ–°æ•°æ® $(date '+%Y.%m.%d %H:%M:%S')"
          git pull
          git push
        fi
